(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[435],{3773:(e,t,a)=>{"use strict";a.d(t,{$:()=>r,f:()=>n});var s=a(2115);let r={genie:{generate:async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"analyst",s=await fetch("https://cxzllzyxwpyptfretryc.supabase.co/functions/v1/aladdin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,context:t,user_role:a})});if(!s.ok)throw Error("AI Genie error: ".concat(s.statusText));return s.json()}},retailBot:{analyze:async function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"performance",s=await fetch("https://cxzllzyxwpyptfretryc.supabase.co/functions/v1/retailbot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e,store_data:t,analysis_type:a})});if(!s.ok)throw Error("RetailBot error: ".concat(s.statusText));return s.json()},forecast:async e=>{let t=await fetch("https://cxzllzyxwpyptfretryc.supabase.co/functions/v1/retailbot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"Generate sales forecast",store_data:e,analysis_type:"forecast"})});if(!t.ok)throw Error("RetailBot forecast error: ".concat(t.statusText));return t.json()}},adsBot:{analyze:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["ctr","conversion","roi"],a=await fetch("https://cxzllzyxwpyptfretryc.supabase.co/functions/v1/adsbot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign_data:e,metrics_focus:t})});if(!a.ok)throw Error("AdsBot error: ".concat(a.statusText));return a.json()},optimizeCreative:async e=>{let t=await fetch("https://cxzllzyxwpyptfretryc.supabase.co/functions/v1/adsbot",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({campaign_data:e,analysis_type:"creative",metrics_focus:["engagement","conversion"]})});if(!t.ok)throw Error("AdsBot creative optimization error: ".concat(t.statusText));return t.json()}}};function n(){let[e,t]=(0,s.useState)(!1),[a,n]=(0,s.useState)(null),l=(0,s.useCallback)(async(e,a,s)=>{t(!0),n(null);try{return await r.genie.generate(e,a,s)}catch(e){throw n(e instanceof Error?e.message:"Unknown error"),e}finally{t(!1)}},[]);return{loading:e,error:a,askGenie:l,analyzeRetail:(0,s.useCallback)(async(e,a)=>{t(!0),n(null);try{return await r.retailBot.analyze(e,a)}catch(e){throw n(e instanceof Error?e.message:"Unknown error"),e}finally{t(!1)}},[]),analyzeAds:(0,s.useCallback)(async(e,a)=>{t(!0),n(null);try{return await r.adsBot.analyze(e,a)}catch(e){throw n(e instanceof Error?e.message:"Unknown error"),e}finally{t(!1)}},[])}}},7999:(e,t,a)=>{Promise.resolve().then(a.bind(a,8658))},8658:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Z});var s=a(5155),r=a(2115),n=a(3579);function l(e){let{tabs:t,activeTab:a,onSelect:r}=e;return(0,s.jsx)("nav",{className:"tab-nav",children:t.map(e=>(0,s.jsxs)("button",{onClick:()=>r(e.id),className:"tab-button ".concat(a===e.id?"active":""),children:[e.icon&&(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.label]},e.id))})}function i(e){let{filters:t,onChange:a,availableFilters:r}=e;return(0,s.jsxs)("div",{className:"filter-bar",children:[(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"Date Range"}),(0,s.jsx)("input",{type:"date",value:t.dateRange.start.toISOString().split("T")[0],onChange:e=>a({dateRange:{...t.dateRange,start:new Date(e.target.value)}}),className:"filter-select"}),(0,s.jsx)("span",{className:"mx-2 text-gray-500",children:"to"}),(0,s.jsx)("input",{type:"date",value:t.dateRange.end.toISOString().split("T")[0],onChange:e=>a({dateRange:{...t.dateRange,end:new Date(e.target.value)}}),className:"filter-select"})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"Region"}),(0,s.jsxs)("select",{value:t.region||"",onChange:e=>a({region:e.target.value||void 0}),className:"filter-select",children:[(0,s.jsx)("option",{value:"",children:"All Regions"}),r.regions.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"Category"}),(0,s.jsxs)("select",{value:t.category||"",onChange:e=>a({category:e.target.value||void 0}),className:"filter-select",children:[(0,s.jsx)("option",{value:"",children:"All Categories"}),r.categories.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsx)("label",{className:"filter-label",children:"Brand"}),(0,s.jsxs)("select",{value:t.brand||"",onChange:e=>a({brand:e.target.value||void 0}),className:"filter-select",children:[(0,s.jsx)("option",{value:"",children:"All Brands"}),r.brands.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsx)("button",{onClick:()=>a({location:void 0,category:void 0,brand:void 0,region:void 0}),className:"ml-auto text-sm text-blue-600 hover:text-blue-700",children:"Clear Filters"})]})}function c(e){let{title:t,value:a,change:r,trend:n,subtitle:l}=e;return(0,s.jsxs)("div",{className:"kpi-card",children:[(0,s.jsx)("div",{className:"kpi-label",children:t}),(0,s.jsx)("div",{className:"kpi-value",children:a}),l&&(0,s.jsx)("div",{className:"text-sm text-gray-500 mt-1",children:l}),void 0!==r&&(0,s.jsxs)("div",{className:"kpi-change ".concat(r>=0?"positive":"negative"),children:[r>=0?"+":"",r.toFixed(1),"%","up"===n&&" ↑","down"===n&&" ↓"]})]})}var o=a(3540),d=a(3504),u=a(4754),h=a(6025),x=a(2071),m=a(4021),g=a(2366);function v(e){let{data:t,metric:a,color:r="#3b82f6"}=e;return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(d.b,{data:t,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(h.W,{dataKey:"date",stroke:"#64748b",fontSize:12,tickFormatter:e=>new Date(e).toLocaleDateString("en",{day:"numeric",month:"short"})}),(0,s.jsx)(x.h,{stroke:"#64748b",fontSize:12,tickFormatter:e=>"₱".concat((e/1e3).toFixed(0),"k")}),(0,s.jsx)(m.m,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0"},labelStyle:{color:"#1e293b"},formatter:e=>["₱".concat(e.toLocaleString()),a]}),(0,s.jsx)(g.N,{type:"monotone",dataKey:a,stroke:r,strokeWidth:2,dot:!1})]})})}function j(e){let{data:t,metric:a}=e,r=Math.max(...t.map(e=>e[a]||0));return(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2",children:t.map(e=>{let t=(e[a]||0)/r;return(0,s.jsxs)("div",{className:"p-3 rounded text-center",style:{backgroundColor:"rgba(59, 130, 246, ".concat(t,")")},children:[(0,s.jsx)("div",{className:"font-semibold text-sm",children:e.name}),(0,s.jsxs)("div",{className:"text-xs mt-1",children:["₱",((e[a]||0)/1e3).toFixed(1),"k"]})]},e.name)})})}function y(e){let{data:t,type:a}=e;return t&&0!==t.length?(0,s.jsx)("div",{className:"space-y-3",children:t.map((e,a)=>{var r;let n=(null==(r=t[0])?void 0:r.revenue)||1,l=e.revenue/n*100;return(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsxs)("span",{className:"font-medium",children:[a+1,". ",e.name]}),(0,s.jsxs)("span",{className:"text-gray-600",children:["₱",(e.revenue/1e3).toFixed(1),"k"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(l,"%")}})}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[e.count," transactions"]})]},e.name||a)})}):(0,s.jsx)("div",{className:"text-gray-500 text-center py-4",children:"No data available"})}function f(e){var t,a,n,l;let{data:i,aggregated:o,filters:d,userRole:u}=e,h=(0,r.useMemo)(()=>{var e,t,a,s;let r=.85*i.reduce((e,t)=>e+t.peso_value,0),n=r>0?(o.totalRevenue-r)/r*100:0;return{revenue:{value:o.totalRevenue,change:n,label:"Total Revenue"},transactions:{value:o.totalTransactions,change:12.5,label:"Transactions"},avgBasket:{value:o.avgBasketSize,change:-2.3,label:"Avg Basket Size"},topCategory:{value:(null==(t=o.topCategories)||null==(e=t[0])?void 0:e.name)||"N/A",revenue:(null==(s=o.topCategories)||null==(a=s[0])?void 0:a.revenue)||0,label:"Top Category"}}},[i,o,d]),x=(0,r.useMemo)(()=>{switch(u){case"executive":return["revenue","transactions","avgBasket","topCategory"];case"regional_manager":return["revenue","transactions","avgBasket"];case"store_owner":return["transactions","avgBasket"];default:return["revenue","transactions"]}},[u]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"col-span-full grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[x.includes("revenue")&&(0,s.jsx)(c,{title:h.revenue.label,value:"₱".concat((h.revenue.value/1e3).toFixed(1),"k"),change:h.revenue.change,trend:"up"}),x.includes("transactions")&&(0,s.jsx)(c,{title:h.transactions.label,value:h.transactions.value.toLocaleString(),change:h.transactions.change,trend:"up"}),x.includes("avgBasket")&&(0,s.jsx)(c,{title:h.avgBasket.label,value:"₱".concat(h.avgBasket.value.toFixed(2)),change:h.avgBasket.change,trend:"down"}),x.includes("topCategory")&&(0,s.jsx)(c,{title:h.topCategory.label,value:h.topCategory.value,subtitle:"₱".concat((h.topCategory.revenue/1e3).toFixed(1),"k")})]}),(0,s.jsxs)("div",{className:"card col-span-full md:col-span-2",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Revenue Trend"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(v,{data:o.dailyMetrics,metric:"revenue",color:"#10b981"})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Regional Performance"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(j,{data:o.regionMetrics,metric:"revenue"})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Top Products"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(y,{data:null==(t=o.topCategories)?void 0:t.slice(0,5),type:"category"})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Top Brands"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(y,{data:null==(a=o.topBrands)?void 0:a.slice(0,5),type:"brand"})})]}),"executive"===u&&(0,s.jsxs)("div",{className:"card col-span-full",children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h4",{children:"Executive Insights"}),(0,s.jsx)("button",{className:"text-sm text-blue-600 hover:text-blue-700",children:"Ask Aladdin"})]}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)("div",{className:"bg-blue-50 p-4 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Revenue is up ",h.revenue.change.toFixed(1),"% compared to the previous period.",null==(l=o.topCategories)||null==(n=l[0])?void 0:n.name," continues to be the top-performing category. Consider focusing marketing efforts on underperforming regions."]})})})]})]})}function p(e){let{title:t,views:a,data:n,filters:l,className:i=""}=e,c=Object.keys(a),[o,d]=(0,r.useState)(c[0]),u=a[o],h=(0,r.useMemo)(()=>({volume:"Transaction Volume",revenue:"Revenue Trend",basket:"Basket Size",duration:"Shopping Duration",mix:"Category Mix",pareto:"Pareto Analysis",subs:"Substitutions",basketHeat:"Basket Heatmap",funnel:"Purchase Funnel",methods:"Request Methods",acceptance:"Acceptance Rate",traits:"Behavior Traits",demographics:"Demographics",ageGender:"Age & Gender",location:"Location",segment:"Segments",...Object.fromEntries(c.map(e=>[e,e]))}),[c]);return(0,s.jsxs)("div",{className:"card ".concat(i),children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h4",{children:t}),c.length>1&&(0,s.jsx)("select",{value:o,onChange:e=>d(e.target.value),className:"text-sm px-2 py-1 border rounded",children:c.map(e=>(0,s.jsx)("option",{value:e,children:h[e]},e))})]}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)("div",{className:"chart-container",children:(0,s.jsx)(u,{data:n,filters:l})})})]})}var b=a(3401),N=a(9429);function k(e){let{data:t}=e,a=(0,r.useMemo)(()=>(null==t?void 0:t.dailyMetrics)?t.dailyMetrics.slice(-7).map(e=>({date:new Date(e.date).toLocaleDateString("en",{weekday:"short"}),volume:e.count})):[],[t]);return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:a,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(h.W,{dataKey:"date",stroke:"#64748b",fontSize:12}),(0,s.jsx)(x.h,{stroke:"#64748b",fontSize:12}),(0,s.jsx)(m.m,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0"},labelStyle:{color:"#1e293b"}}),(0,s.jsx)(N.y,{dataKey:"volume",fill:"#3b82f6",radius:[4,4,0,0]})]})})}function w(e){let{data:t}=e,a=(0,r.useMemo)(()=>(null==t?void 0:t.dailyMetrics)?t.dailyMetrics.slice(-30).map(e=>({date:new Date(e.date).toLocaleDateString("en",{day:"numeric",month:"short"}),revenue:e.revenue})):[],[t]);return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(d.b,{data:a,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(h.W,{dataKey:"date",stroke:"#64748b",fontSize:12}),(0,s.jsx)(x.h,{stroke:"#64748b",fontSize:12,tickFormatter:e=>"₱".concat((e/1e3).toFixed(0),"k")}),(0,s.jsx)(m.m,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0"},labelStyle:{color:"#1e293b"},formatter:e=>"₱".concat(e.toLocaleString())}),(0,s.jsx)(g.N,{type:"monotone",dataKey:"revenue",stroke:"#10b981",strokeWidth:2,dot:!1})]})})}function S(e){let{data:t}=e,a=(0,r.useMemo)(()=>(null==t?void 0:t.dailyMetrics)?t.dailyMetrics.slice(-14).map(e=>({date:new Date(e.date).toLocaleDateString("en",{day:"numeric"}),avgBasket:e.revenue/e.count})):[],[t]);return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(d.b,{data:a,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(h.W,{dataKey:"date",stroke:"#64748b",fontSize:12}),(0,s.jsx)(x.h,{stroke:"#64748b",fontSize:12,tickFormatter:e=>"₱".concat(e.toFixed(0))}),(0,s.jsx)(m.m,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0"},labelStyle:{color:"#1e293b"},formatter:e=>"₱".concat(e.toFixed(2))}),(0,s.jsx)(g.N,{type:"monotone",dataKey:"avgBasket",stroke:"#f59e0b",strokeWidth:2,dot:{fill:"#f59e0b",r:3}})]})})}function C(e){let{data:t}=e;return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:[{duration:"0-5 min",count:120},{duration:"5-10 min",count:200},{duration:"10-20 min",count:150},{duration:"20-30 min",count:80},{duration:"30+ min",count:50}],layout:"horizontal",children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3",stroke:"#f1f5f9"}),(0,s.jsx)(h.W,{type:"number",stroke:"#64748b",fontSize:12}),(0,s.jsx)(x.h,{type:"category",dataKey:"duration",stroke:"#64748b",fontSize:12}),(0,s.jsx)(m.m,{contentStyle:{backgroundColor:"#fff",border:"1px solid #e2e8f0"},labelStyle:{color:"#1e293b"}}),(0,s.jsx)(N.y,{dataKey:"count",fill:"#8b5cf6",radius:[0,4,4,0]})]})})}var R=a(170),D=a(8357),T=a(4811);let z=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899"];function B(e){let{data:t}=e,a=(null==t?void 0:t.slice(0,6))||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(R.r,{children:[(0,s.jsx)(D.F,{data:a,cx:"50%",cy:"50%",labelLine:!1,outerRadius:80,fill:"#8884d8",dataKey:"revenue",label:e=>{let{name:t,percent:a}=e;return"".concat(t," ").concat((100*(a||0)).toFixed(0),"%")},children:a.map((e,t)=>(0,s.jsx)(T.f,{fill:z[t%z.length]},"cell-".concat(t)))}),(0,s.jsx)(m.m,{formatter:e=>"₱".concat(e.toLocaleString())})]})})}function M(e){let{data:t}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Pareto Analysis Chart"})}function A(e){let{data:t}=e;return(0,s.jsx)("div",{className:"overflow-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b",children:[(0,s.jsx)("th",{className:"text-left py-2",children:"Product"}),(0,s.jsx)("th",{className:"text-right py-2",children:"Substitution Rate"})]})}),(0,s.jsxs)("tbody",{children:[(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-2",children:"Product A → Product B"}),(0,s.jsx)("td",{className:"text-right",children:"23%"})]}),(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"py-2",children:"Product C → Product D"}),(0,s.jsx)("td",{className:"text-right",children:"18%"})]})]})]})})}function E(e){let{data:t}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Basket Time Heatmap"})}function F(e){let{data:t}=e,a=(null==t?void 0:t.funnel)||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:a,layout:"horizontal",children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3"}),(0,s.jsx)(h.W,{type:"number"}),(0,s.jsx)(x.h,{type:"category",dataKey:"stage"}),(0,s.jsx)(m.m,{}),(0,s.jsx)(N.y,{dataKey:"count",fill:"#3b82f6"})]})})}function _(e){let{data:t}=e,a=(null==t?void 0:t.methods)||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:a,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3"}),(0,s.jsx)(h.W,{dataKey:"method"}),(0,s.jsx)(x.h,{}),(0,s.jsx)(m.m,{}),(0,s.jsx)(N.y,{dataKey:"count",fill:"#10b981"})]})})}function K(e){let{data:t}=e,a=(null==t?void 0:t.acceptance)||0;return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,s.jsxs)("div",{className:"text-4xl font-bold text-green-600",children:[(100*a).toFixed(1),"%"]}),(0,s.jsx)("div",{className:"text-sm text-gray-500 mt-2",children:"Acceptance Rate"}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-4",children:(0,s.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat(100*a,"%")}})})]})}function O(e){let{data:t}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Behavior Radar Chart"})}let P=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6"];function W(e){let{data:t}=e,a=(null==t?void 0:t.age)||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(R.r,{children:[(0,s.jsx)(D.F,{data:a,cx:"50%",cy:"50%",outerRadius:60,fill:"#8884d8",dataKey:"count",label:e=>{let{range:t}=e;return t},children:a.map((e,t)=>(0,s.jsx)(T.f,{fill:P[t%P.length]},"cell-".concat(t)))}),(0,s.jsx)(m.m,{})]})})}function L(e){let{data:t}=e,a=(null==t?void 0:t.gender)||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:a,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3"}),(0,s.jsx)(h.W,{dataKey:"type"}),(0,s.jsx)(x.h,{}),(0,s.jsx)(m.m,{}),(0,s.jsx)(N.y,{dataKey:"count",fill:"#8b5cf6"})]})})}function I(e){let{data:t}=e,a=(null==t?void 0:t.locations)||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(R.r,{children:[(0,s.jsx)(D.F,{data:a,cx:"50%",cy:"50%",outerRadius:60,fill:"#8884d8",dataKey:"count",nameKey:"name",children:a.map((e,t)=>(0,s.jsx)(T.f,{fill:P[t%P.length]},"cell-".concat(t)))}),(0,s.jsx)(m.m,{})]})})}function G(e){let{data:t}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Segment Analysis Chart"})}function q(e){let{data:t,aggregated:a,filters:n}=e,l=(0,r.useMemo)(()=>{var e;return{transactions:a,products:null==(e=a.topCategories)?void 0:e.slice(0,10),behavior:{funnel:[{stage:"Awareness",count:1e3},{stage:"Interest",count:750},{stage:"Consideration",count:500},{stage:"Purchase",count:250},{stage:"Retention",count:100}],methods:[{method:"Online",count:450},{method:"In-Store",count:350},{method:"Mobile",count:200}],acceptance:.78,traits:[{trait:"Price Conscious",score:.8},{trait:"Brand Loyal",score:.6},{trait:"Impulse Buyer",score:.4},{trait:"Research Driven",score:.7}]},demographics:{age:[{range:"18-24",count:150},{range:"25-34",count:300},{range:"35-44",count:250},{range:"45-54",count:200},{range:"55+",count:100}],gender:[{type:"Male",count:450},{type:"Female",count:520},{type:"Other",count:30}],locations:[{name:"Metro Manila",count:400},{name:"Cebu",count:200},{name:"Davao",count:150},{name:"Others",count:250}],segments:[{name:"Premium",value:25},{name:"Regular",value:50},{name:"Budget",value:25}]}}},[t,a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p,{title:"Transaction Trends",data:l.transactions,filters:n,views:{volume:k,revenue:w,basket:S,duration:C}}),(0,s.jsx)(p,{title:"Product Mix & SKU",data:l.products,filters:n,views:{mix:B,pareto:M,subs:A,basketHeat:E}}),(0,s.jsx)(p,{title:"Consumer Behavior",data:l.behavior,filters:n,views:{funnel:F,methods:_,acceptance:K,traits:O}}),(0,s.jsx)(p,{title:"Consumer Profiling",data:l.demographics,filters:n,views:{demographics:W,ageGender:L,location:I,segment:G}})]})}function U(e){let{data:t,metric:a}=e,r=t["revenue"===a?"daily":"weekly"]||[];return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(d.b,{data:r,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3"}),(0,s.jsx)(h.W,{dataKey:"revenue"===a?"date":"week"}),(0,s.jsx)(x.h,{}),(0,s.jsx)(m.m,{}),(0,s.jsx)(g.N,{type:"monotone",dataKey:a,stroke:"#3b82f6"})]})})}function J(e){let{data:t,periods:a=[7,14,30]}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Moving Average Chart"})}function H(e){let{data:t}=e;return(0,s.jsx)(o.u,{width:"100%",height:"100%",children:(0,s.jsxs)(b.E,{data:t,children:[(0,s.jsx)(u.d,{strokeDasharray:"3 3"}),(0,s.jsx)(h.W,{dataKey:"day"}),(0,s.jsx)(x.h,{}),(0,s.jsx)(m.m,{}),(0,s.jsx)(N.y,{dataKey:"avgRevenue",fill:"#10b981"})]})})}function $(e){let{data:t}=e;return(0,s.jsx)("div",{className:"text-center text-gray-500 py-8",children:"Growth Rate Analysis"})}function Q(e){let{data:t,aggregated:a,filters:n}=e,l=(0,r.useMemo)(()=>({daily:a.dailyMetrics||[],weekly:function(e){let t=[];for(let a=0;a<e.length;a+=7){let s=e.slice(a,a+7);s.length>0&&t.push({week:"Week ".concat(Math.floor(a/7)+1),revenue:s.reduce((e,t)=>e+t.revenue,0),count:s.reduce((e,t)=>e+t.count,0)})}return t}(a.dailyMetrics||[]),monthly:function(e){let t={};return e.forEach(e=>{let a=new Date(e.date).toLocaleDateString("en",{year:"numeric",month:"short"});t[a]||(t[a]={month:a,revenue:0,count:0}),t[a].revenue+=e.revenue,t[a].count+=e.count}),Object.values(t)}(a.dailyMetrics||[]),seasonal:[{day:"Monday",avgRevenue:45e3,avgTransactions:120},{day:"Tuesday",avgRevenue:48e3,avgTransactions:125},{day:"Wednesday",avgRevenue:52e3,avgTransactions:135},{day:"Thursday",avgRevenue:51e3,avgTransactions:130},{day:"Friday",avgRevenue:65e3,avgTransactions:165},{day:"Saturday",avgRevenue:72e3,avgTransactions:180},{day:"Sunday",avgRevenue:58e3,avgTransactions:145}]}),[t,a]);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card col-span-full md:col-span-2",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Revenue Trends"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(U,{data:l,metric:"revenue"})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Growth Analysis"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)($,{data:l})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Moving Averages"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(J,{data:l.daily,periods:[7,14,30]})})]}),(0,s.jsxs)("div",{className:"card col-span-full",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Seasonality Patterns"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)(H,{data:l.seasonal})})]})]})}var V=a(3773);function X(e){let{data:t,aggregated:a,filters:n,userRole:l="analyst"}=e,[i,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1),[u,h]=(0,r.useState)("aladdin"),x=async e=>{d(!0);try{let t;switch(u){case"aladdin":t=await V.$.genie.generate("Generate ".concat(e," insights for the current data"),{metrics:a,filters:n},l);break;case"retailbot":t=await V.$.retailBot.analyze("What are the key ".concat(e," insights?"),a);break;case"adsbot":t=await V.$.adsBot.analyze(a,["performance","trends","optimization"])}c(t)}catch(e){console.error("Error generating insights:",e)}finally{d(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card col-span-full",children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h4",{children:"AI Assistant Selection"}),(0,s.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"text-sm px-3 py-1 border rounded",children:[(0,s.jsx)("option",{value:"aladdin",children:"\uD83E\uDDDE Aladdin Insights"}),(0,s.jsx)("option",{value:"retailbot",children:"\uD83C\uDFEA RetailBot"}),(0,s.jsx)("option",{value:"adsbot",children:"\uD83D\uDCE2 AdsBot"})]})]}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,s.jsx)("button",{onClick:()=>x("executive-summary"),disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 disabled:opacity-50",children:"Executive Summary"}),(0,s.jsx)("button",{onClick:()=>x("anomaly"),disabled:o,className:"px-4 py-2 bg-purple-600 text-white rounded hover:bg-purple-700 disabled:opacity-50",children:"Detect Anomalies"}),(0,s.jsx)("button",{onClick:()=>x("trends"),disabled:o,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 disabled:opacity-50",children:"Trend Analysis"}),(0,s.jsx)("button",{onClick:()=>x("what-if"),disabled:o,className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 disabled:opacity-50",children:"What-If Scenario"})]})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Ask a Question"})}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("textarea",{className:"w-full p-3 border rounded-lg resize-none",rows:3,placeholder:"Type your question here...",onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||e.preventDefault()}}),(0,s.jsx)("button",{className:"mt-3 w-full px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Get Answer"})]})]}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card col-span-full md:col-span-2",children:[(0,s.jsxs)("div",{className:"card-header",children:[(0,s.jsx)("h4",{children:"AI Analysis"}),(0,s.jsx)("span",{className:"text-xs text-gray-500",children:new Date(i.generated_at||Date.now()).toLocaleString()})]}),(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)("p",{className:"whitespace-pre-wrap",children:i.content||i.analysis||i.insights})}),i.metadata&&(0,s.jsxs)("div",{className:"mt-4 text-xs text-gray-500",children:["Model: ",i.metadata.model," | Confidence: ",(i.metadata.confidence||i.confidence||90).toFixed(0),"%"]})]})]}),(i.recommendations||i.optimization_tips)&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Recommendations"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)("ul",{className:"space-y-2",children:(i.recommendations||i.optimization_tips||[]).map((e,t)=>(0,s.jsxs)("li",{className:"flex items-start",children:[(0,s.jsx)("span",{className:"text-green-500 mr-2",children:"•"}),(0,s.jsx)("span",{className:"text-sm",children:e})]},t))})})]}),(i.metrics||i.performance_metrics)&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"card-header",children:(0,s.jsx)("h4",{children:"Key Metrics"})}),(0,s.jsx)("div",{className:"card-body",children:(0,s.jsx)("div",{className:"grid grid-cols-2 gap-3",children:Object.entries(i.metrics||i.performance_metrics||{}).map(e=>{let[t,a]=e;return(0,s.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded",children:[(0,s.jsx)("div",{className:"text-xs text-gray-500 uppercase",children:t}),(0,s.jsx)("div",{className:"text-lg font-semibold",children:String(a)})]},t)})})})]})]}),o&&(0,s.jsx)("div",{className:"card col-span-full",children:(0,s.jsx)("div",{className:"card-body flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-3 text-sm text-gray-600",children:"Generating insights..."})]})})})]})}let Y=[{id:"overview",label:"Overview",icon:"\uD83D\uDCCA"},{id:"databank",label:"Databank",icon:"\uD83D\uDDC4️"},{id:"trends",label:"Trends",icon:"\uD83D\uDCC8"},{id:"ai-insights",label:"AI Insights",icon:"\uD83E\uDDDE"}];function Z(){let{user:e}=function(){let[e,t]=(0,r.useState)(null),[a,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(!0),c=(0,n.createClientComponentClient)();return(0,r.useEffect)(()=>{!async function(){try{let{data:{user:e}}=await c.auth.getUser();if(t(e),e){let{data:t}=await c.from("profiles").select("*").eq("id",e.id).single();s(t)}}catch(e){console.error("Error loading user:",e)}finally{i(!1)}}();let{data:{subscription:e}}=c.auth.onAuthStateChange(async(e,a)=>{var r;if(t(null!=(r=null==a?void 0:a.user)?r:null),null==a?void 0:a.user){let{data:e}=await c.from("profiles").select("*").eq("id",a.user.id).single();s(e)}else s(null)});return()=>{e.unsubscribe()}},[c]),{user:a||e,loading:l,isAuthenticated:!!e}}(),[t,a]=(0,r.useState)("overview"),[c,o]=(0,r.useState)({dateRange:{start:new Date(Date.now()-2592e6),end:new Date}}),{data:d,loading:u,error:h}=function(e){let[t,a]=(0,r.useState)([]),[s,l]=(0,r.useState)(!0),[i,c]=(0,r.useState)(null),o=(0,n.createClientComponentClient)();return(0,r.useEffect)(()=>{!async function(){try{l(!0),c(null);let t=o.from("transactions").select("*").gte("timestamp",e.dateRange.start.toISOString()).lte("timestamp",e.dateRange.end.toISOString()).order("timestamp",{ascending:!1}).limit(1e4);e.location&&(t=t.eq("store_id",e.location)),e.region&&(t=t.eq("region",e.region)),e.category&&(t=t.eq("category",e.category)),e.brand&&(t=t.eq("brand",e.brand));let{data:s,error:r}=await t;if(r)throw r;a(s||[])}catch(e){console.error("Error fetching transaction data:",e),c(e)}finally{l(!1)}}()},[e,o]),{data:t,loading:s,error:i}}(c),x=(0,r.useMemo)(()=>d?d.filter(e=>{if(c.location&&e.store_id!==c.location||c.category&&e.category!==c.category||c.brand&&e.brand!==c.brand||c.region&&e.region!==c.region)return!1;let t=new Date(e.timestamp);return!(t<c.dateRange.start)&&!(t>c.dateRange.end)}):[],[d,c]),m=(0,r.useMemo)(()=>x.length?{totalRevenue:x.reduce((e,t)=>e+t.peso_value,0),totalTransactions:x.length,avgBasketSize:x.reduce((e,t)=>e+t.peso_value,0)/x.length,topCategories:et(x,"category"),topBrands:et(x,"brand"),dailyMetrics:function(e){let t={};return e.forEach(e=>{let a=new Date(e.timestamp).toISOString().split("T")[0];t[a]||(t[a]={count:0,revenue:0}),t[a].count++,t[a].revenue+=e.peso_value}),Object.entries(t).map(e=>{let[t,a]=e;return{date:t,...a}}).sort((e,t)=>e.date.localeCompare(t.date))}(x),regionMetrics:et(x,"region")}:null,[x]),g=(0,r.useCallback)(e=>{o(t=>({...t,...e}))},[]);return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)("header",{className:"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50",children:(0,s.jsx)("div",{className:"px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Scout Databank"}),(0,s.jsxs)("span",{className:"ml-3 text-sm text-gray-500",children:["Welcome, ",(null==e?void 0:e.full_name)||"User"," (",null==e?void 0:e.role,")"]})]}),(0,s.jsx)("div",{className:"flex items-center space-x-4",children:(0,s.jsx)("button",{className:"text-gray-500 hover:text-gray-700",children:(0,s.jsxs)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})})]})})}),(0,s.jsx)(i,{filters:c,onChange:g,availableFilters:{locations:ee(d||[],"store_id"),categories:ee(d||[],"category"),brands:ee(d||[],"brand"),regions:ee(d||[],"region")}}),(0,s.jsx)(l,{tabs:Y,activeTab:t,onSelect:e=>a(e)}),(0,s.jsxs)("main",{className:"grid-container",children:[u&&(0,s.jsx)("div",{className:"col-span-full flex items-center justify-center py-12",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard data..."})]})}),h&&(0,s.jsx)("div",{className:"col-span-full",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:["Error loading data: ",h.message]})}),!u&&!h&&m&&(0,s.jsxs)(s.Fragment,{children:["overview"===t&&(0,s.jsx)(f,{data:x,aggregated:m,filters:c,userRole:null==e?void 0:e.role}),"databank"===t&&(0,s.jsx)(q,{data:x,aggregated:m,filters:c}),"trends"===t&&(0,s.jsx)(Q,{data:x,aggregated:m,filters:c}),"ai-insights"===t&&(0,s.jsx)(X,{data:x,aggregated:m,filters:c,userRole:null==e?void 0:e.role})]})]})]})}function ee(e,t){return Array.from(new Set(e.map(e=>String(e[t]))).values()).filter(Boolean)}function et(e,t){let a={};return e.forEach(e=>{let s=e[t]||"Unknown";a[s]||(a[s]={count:0,revenue:0}),a[s].count++,a[s].revenue+=e.peso_value}),Object.entries(a).map(e=>{let[t,a]=e;return{name:t,...a}}).sort((e,t)=>t.revenue-e.revenue)}}},e=>{e.O(0,[222,579,441,964,358],()=>e(e.s=7999)),_N_E=e.O()}]);